(function(d,k){var o=d.proxy,j=d.isPlainObject,q=d.extend,t=k.support.browser,b=":not(.k-group-cell):not(.k-hierarchy-cell):visible",e="click",p=".kendoGrid",m="dataBound",l;function f(w){var v=[];for(var u=0;u<w.length;u++){if(!w[u].columns){v.push(w[u]);continue}v=v.concat(f(w[u].columns))}return v}function g(w){var v=[];for(var u=0;u<w.length;u++){if(w[u].hidden){continue}if(w[u].columns){v=v.concat(g(w[u].columns))}else{v.push(w[u])}}return v}function n(u){return r([u]).length>0}function r(u){return d.grep(u,function(w){var v=!w.hidden;if(v&&w.columns){v=r(w.columns).length>0}return v})}function c(v,A){var u=t.msie;if(A===true){v=d(v);var z=true||u&&v.parent().is(".k-grid-content,.k-grid-header-wrap"),x,y;if(z){x=v.parent().scrollTop();y=v.parent().scrollLeft()}if(u){try{v[0].setActive()}catch(w){v[0].focus()}}else{v[0].focus()}if(z){v.parent().scrollTop(x);v.parent().scrollLeft(y)}}else{d(v).one("focusin",function(B){B.preventDefault()}).focus()}}function s(u){return function(v,w){if(u.editor){u.editor(v,w);v.find("input, select, textarea, a, button, select").attr("ng-disabled",true).addClass("k-input").removeAttr("ng-readonly").removeAttr("ng-show");setTimeout(function(){v.find("input, select, textarea, a, button, select").attr("disabled","disabled")},200)}else{var x=d("<div/>",{"ng-bind":"dataItem."+w.field});x.appendTo(v)}}}function h(v,y,u,x){var w;v.collapseRow(y);w=angular.element(x.find("td.k-detail-cell > div")).scope();x.remove();if(angular.isDefined(w)){w.vc.removeChildVc(u);w.$destroy()}}function a(x,u){var w,A,v,z,y;if(u&&x._hasDetails()&&x._editMode()!=="popup"&&angular){w=u.uid;A=x.tbody.find("tr[data-uid="+w+"]");z=A.find("+ tr.k-detail-row");if(z.length>0){h(x,A,w,z)}else{z=x.tbody.find("tr.k-detail-row");if(z.length>0){A=z.prev("tr.k-master-row");if(A.length>0){w=A.attr(k.attr("uid"));h(x,A,w,z)}}}}}function i(x,v){var w,y,u;if(v&&x._hasDetails()&&x._editMode()!=="popup"){w=v.uid;y=d("tr[data-uid="+w+"]");if(y.length>0){u=y.find("> td:last").index();y.find(".k-hierarchy-cell").each(function(){var z=d(this).siblings().eq(u-1);if(z){d(this).insertAfter(z)}})}}}l=k.ui.Grid.extend({options:{name:"ExtGrid"},init:function(w,u){var y=this,x=u.dataBound,v=u.details;if(typeof v!=="undefined"){u.dataBound=function(B){var z=B.sender,A;z.tbody.find("> tr").each(function(){if(this.oncontextmenu===null){this.oncontextmenu=function(C){A=C.currentTarget;setTimeout(function(){y.showDetails(A)},100);return false}}});if(typeof x!=="undefined"&&x!==null){x.call(this,B)}}}k.ui.Grid.fn.init.call(this,w,u);d(w).data("kendoGrid",y)},_editCancelClick:function(w){k.ui.Grid.fn._editCancelClick.call(this,w);var u=this,v;u.tbody.find("> tr").each(function(){if(this.oncontextmenu===null){this.oncontextmenu=function(x){v=x.currentTarget;setTimeout(function(){u.showDetails(v)},100);return false}}});u.options.dataBound({sender:u})},_destroyDetailEditable:function(){var w=this,v=this,x;var u=function(){if(w.editable){var y=w.editView?w.editView.element:w._editContainer;if(y){y.off(e+p,"a.k-grid-cancel",w._editCancelClickHandler);y.off(e+p,"a.k-grid-update",w._editUpdateClickHandler)}w._detachModelChange();w.editable.destroy();w.editable=null;w._editContainer=null;w._destroyEditView()}};if(w.editable&&w._editContainer.data("kendoWindow")){w._editContainer.data("kendoWindow").bind("deactivate",u).close()}if(w._actionSheet){w._actionSheet.destroy();w._actionSheet=null}v.tbody.find("> tr").each(function(){if(this.oncontextmenu===null){this.oncontextmenu=function(y){x=y.currentTarget;setTimeout(function(){v.showDetails(x)},100);return false}}})},_cancelDetailRow:function(){var w=this,u=w._editContainer,v,x;if(u){var y=u.attr(k.attr("uid"));v=w.dataSource.getByUid(y);a(w,v);w._destroyDetailEditable();w.dataSource.cancelChanges(v);w._displayRow(w.tbody.find("["+k.attr("uid")+"="+v.uid+"]"))}},_refreshCloseDetail:function(){var B=this,u,F,A="",y=B.dataSource.view(),E=B.options.navigatable,D,C=d(B.current()),z=false,w=(B.dataSource.group()||[]).length,x=B.content&&B.content.scrollLeft(),v=w+g(r(B.columns)).length;B._angularItems("cleanup");if(E&&(B._isActiveInTable()||(B._editContainer&&B._editContainer.data("kendoWindow")))){z=C.is("th");D=0;if(z){D=B.thead.find("th:not(.k-group-cell)").index(C)}}B._destroyEditable();B._progress(false);B._hideResizeHandle();B._data=[];if(!B.columns.length){B._autoColumns(B._firstDataItem(y[0],w));v=w+B.columns.length}B._group=w>0||B._group;if(B._group){B._templates();B._updateCols();B._updateLockedCols();B._updateHeader(w);B._group=w>0}B._renderContent(y,v,w);B._renderLockedContent(y,v,w);B._footer();B._setContentHeight();B._setContentWidth(x);if(B.lockedTable){if(B.options.scrollable.virtual){B.content.find(">.k-virtual-scrollable-wrap").trigger("scroll")}else{if(B.touchScroller){B.touchScroller.movable.trigger("change")}else{B.content.trigger("scroll")}}}if(D>=0){B._removeCurrent();if(!z){B.current(B.table.add(B.lockedTable).find(FIRSTNAVITEM).first())}else{B.current(B.thead.find("th:not(.k-group-cell)").eq(D))}if(B._current){c(B._current.closest("table")[0],true)}}if(B.touchScroller){B.touchScroller.contentResized()}if(B.selectable){B.selectable.resetTouchEvents()}B._angularItems("compile");B.trigger(m)},_createDetailEditor:function(E){var G=this,D="<div "+k.attr("uid")+'="'+E.uid+'" class="k-popup-edit-form'+(G._isMobile?" k-mobile-list":"")+'"><div class="k-edit-form-container">',B,C,F=[],I,x,H,A=f(G.columns),y=G.options.editable,J=j(y)?y.window:{},z=q({},k.Template,G.options.templateSettings),w,u=G.options.details;J=J||{};for(I=0,x=A.length;I<x;I++){B=A[I];if(!B.command){D+='<div class="k-edit-label"><label for="'+B.field+'">'+(B.title||B.field||"")+"</label></div>";if((!E.editable||E.editable(B.field))&&B.field){C=s(B);F.push({field:B.field,format:B.format,editor:C,values:B.values});D+="<div "+k.attr("container-for")+'="'+B.field.trim()+'" class="k-edit-field"></div>'}else{var v={storage:{},count:0};H=k.template(G._cellTmpl(B,v),z);if(v.count>0){H=o(H,v.storage)}D+='<div class="k-edit-field">'+H(E)+"</div>"}}}if(!G._isMobile&&angular.isDefined(u)){w=G._editContainer=d(D).appendTo(G.wrapper).eq(0).kendoWindow(q({modal:true,resizable:false,draggable:true,width:u.width,height:u.height,title:u.title||"Details",visible:false,close:function(L){if(L.userTriggered){L.sender.element.focus();var K=G.items().index(d(G.current()).parent());G._cancelDetailRow();G._refreshCloseDetail();if(G.options.navigatable){G.current(G.items().eq(K).children().filter(b).first());c(G.table,true)}}}},J))}if(G._editContainer){G.editable=G._editContainer.kendoEditable({fields:F,model:E,clearContainer:false,target:G}).data("kendoEditable");G._openPopUpEditor()}},showDetails:function(x){var w=this,v,u;if(x instanceof k.data.ObservableObject){v=x}else{x=d(x);var y=x.attr(k.attr("uid"));v=this.dataSource.getByUid(y)}if(v){w._createDetailEditor(v);u=w.editView?w.editView.element:w._editContainer;if(u){if(!this._editCancelClickHandler){this._editCancelClickHandler=o(this._editCancelClick,this)}u.on(e+p,"a.k-grid-cancel",this._editCancelClickHandler)}}d('.k-window input[type="text"]:visible').each(function(){var z=d(this).closest(".k-edit-field");if(z.length>0&&z[0].firstChild.localName!="span"){z.append(d(this).val()).children().hide()}else{z.addClass("cb-grid-read-detail")}})},cancelRow:function(){var y=this,u=y._editContainer,w,x,v,A,z;if(u){w=y._modelForContainer(u);a(y,w)}k.ui.Grid.fn.cancelRow.call(y);i(y,w)},saveRow:function(){var w=this,u=w._editContainer,v=w._modelForContainer(u);a(w,v);k.ui.Grid.fn.saveRow.call(w)},destroy:function(){var u=this;if(typeof u.__destroyed==="undefined"){u.__destroyed=true;k.ui.Grid.fn.destroy.call(u)}}});k.ui.plugin(l)}(window.kendo.jQuery,window.kendo));