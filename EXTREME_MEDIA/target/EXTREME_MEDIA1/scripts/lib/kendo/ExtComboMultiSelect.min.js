(function(h,g,c){var j=g.ui,b=j.DropDownList,p=g.keys,i="select",l="selectionChanged",f="k-state-selected",o="k-state-active",k="custom-multiselect-check-item",n="custom-multiselect-selectAll-item",a="custom-multiselect-popup",e="custom-multiselect-summary-empty",d='<input type="checkbox" name="#= {1} #" value="#= {0} #" class="'+k+'"/><span data-value="#= {0} #">#= {1} #</span>',m=b.extend({init:function(r,q){q.template=g.template(g.format(d,q.dataValueField,q.dataTextField));b.fn.init.call(this,r,q)},options:{name:"ExtComboMultiSelect",index:-1,showSelectAll:null,preSummaryCount:1,emptySelectionLabel:null,selectionChanged:null},events:[l],refresh:function(){b.fn.refresh.call(this);this._updateSummary();c(this.popup.element).addClass(a)},current:function(q){return this._current},open:function(){this._removeSelectAllItem();this._addSelectAllItem();b.fn.open.call(this);this.popup.one("close",c.proxy(this._onPopupClosed,this))},_onPopupClosed:function(){this._removeSelectAllItem();this._current=null;this._raiseSelectionChanged()},_raiseSelectionChanged:function(){var u=this.value(),r=null,w=null,v=[],q,x,t,s;if(c.isArray(u)){w=u}else{w=u.split(",")}r=c.map(w.sort(),function(y){return y.toString()});s=c.map(r,function(y){return y.toString()});if(c.isArray(this._oldValue)){v=this._oldValue}else{if(typeof s!=="undefined"){if(typeof this._oldValue!=="string"){this._oldValue=String(this._oldValue)}v=this._oldValue.split(",")}}q=c.map(v.sort(),function(y){return y.toString()});x={newValue:r,oldValue:q};if(q){t=(c(q).not(r).length===0&&c(r).not(q).length===0)!==true;if(t){this.trigger(l,x)}}else{if(u.length>0){this.trigger(l,x)}}},_addSelectAllItem:function(){if(!this.options.showSelectAll){return}var q=this.ul.children("li:first"),r;if(q.length>0){this.selectAllListItem=c('<li tabindex="-1" role="option" unselectable="on" class="k-item '+n+'"></li>').insertBefore(q);r={};r[this.options.dataValueField]="*";r[this.options.dataTextField]="All";this.selectAllListItem.html(this.options.template(r));this._updateSelectAllItem();this._makeUnselectable()}},_removeSelectAllItem:function(){if(this.selectAllListItem){this.selectAllListItem.remove()}this.selectAllListItem=null},_focus:function(q){if(this.popup.visible()&&q&&this.trigger(i,{item:q})){this.close();return}this.select(q)},_keydown:function(q){if(q.keyCode===g.keys.HOME||q.keyCode===g.keys.END){q.preventDefault();return}b.fn._keydown.call(this,q)},_keypress:function(q){},_move:function(u){var s=this,r=u.keyCode,q=s.ul[0],v=r===p.DOWN,t;if(r===p.UP||v){if(v){if(!s.popup.visible()){s.toggle(v)}if(!s._current){s._current=q.firstChild}else{s._current=(c(s._current)[0].nextSibling||s._current)}}else{if(s._current){s._current=(c(s._current)[0].previousSibling||q.firstChild)}}if(s._current){s._scroll(s._current)}s._highlightCurrent();u.preventDefault();t=true}else{t=b.fn._move.call(this,u)}return t},selectAll:function(){var q=this._getUnselectedListItems();this._selectItems(q)},unselectAll:function(){var q=this._getSelectedListItems();this._selectItems(q)},_selectItems:function(r){var q=this;c.each(r,function(t,u){var s=j.List.inArray(u,q.ul[0]);q.select(s)})},_selectItem:function(){var s=this,r=s.options,q,t;q=s._isSelect&&!s._initial&&!r.value&&r.index&&!s._bound;if(!q){t=s._selectedValue||r.value||s._accessor()}if(t){s.value(t)}else{if(s._bound===undefined){s.select(r.index)}}},_select:function(r){var t=this,u,v,q,s;r=t._get(r);if(r&&r[0]){q=j.List.inArray(r[0],t.ul[0]);if(q>-1){if(r.hasClass(f)){r.removeClass(f);t._uncheckItem(r);if(this.selectAllListItem&&r[0]===this.selectAllListItem[0]){this.unselectAll()}}else{r.addClass(f);t._checkItem(r);if(this.selectAllListItem&&r[0]===this.selectAllListItem[0]){this.selectAll()}}if(this._open){t._current(r);t._highlightCurrent()}s=this._getSelectedListItems();u=[];v=[];c.each(s,function(x,w){var y=c(w).children("span").first();u.push(y.attr("data-value"));v.push(y.text())});t._updateSummary(v);t._updateSelectAllItem();t._accessor(u,q)}}},_getAllValueListItems:function(){if(this.selectAllListItem){return this.ul.children("li").not(this.selectAllListItem[0])}else{return this.ul.children("li")}},_getSelectedListItems:function(){return this._getAllValueListItems().filter("."+f)},_getUnselectedListItems:function(){return this._getAllValueListItems().filter(":not(."+f+")")},_getSelectedItemsText:function(){var r=[],q=this._getSelectedListItems();c.each(q,function(t,s){var u=c(s).children("span").first();r.push(u.text())});return r},_updateSelectAllItem:function(){if(!this.selectAllListItem){return}if(this._getAllValueListItems().length===this._getSelectedListItems().length){this._checkItem(this.selectAllListItem);this.selectAllListItem.addClass(f)}else{this._uncheckItem(this.selectAllListItem);this.selectAllListItem.removeClass(f)}},_updateSummary:function(q){if(!q){q=this._getSelectedItemsText()}if(q.length===0){this._inputWrapper.addClass(e);this.text(this.options.emptySelectionLabel);return}else{this._inputWrapper.removeClass(e)}if(q.length<=this.options.preSummaryCount){this._textAccessor(q.join(", "))}else{this._textAccessor(q[0]+" y "+(q.length-1)+" m\u00e1s")}},_checkItem:function(q){if(!q){return}q.children("input").prop("checked",true)},_uncheckItem:function(q){if(!q){return}q.children("input").removeAttr("checked")},_isItemChecked:function(q){return q.children("input:checked").length>0},value:function(x){var w=this,r,t=[],v,s,u,q;if(typeof x!=="undefined"){if(typeof x!=="string"){x=String(x)}u=x.split(",");if(u.length>1){t=u;this._oldValue=x}else{t.push(x);this._oldValue=t}c(w.ul[0]).children("li").removeClass(f);c("input",w.ul[0]).removeAttr("checked");c.each(t,function(A,z){var y;if(z!==null){z=z.toString()}w._selectedValue=z;y=x||(w.options.optionLabel&&!w.element[0].disabled&&x==="");if(y&&w._fetchItems(x)){return}r=w._index(z);if(r>-1){w.select(r)}});w._updateSummary()}else{v=this._getSelectedListItems();s=c.map(v,function(y){var z=c(y).children("span").first();return z.attr("data-value")}).join();q=s.split(",");return q}}});j.plugin(m)}(window.angular,window.kendo,window.kendo.jQuery));